# テトリスゲーム - 基本設計書

## 1. プロジェクト概要

### 1.1 目的
Webブラウザで動作する一人用テトリスゲームを開発する。

### 1.2 対象ユーザー
- Webブラウザを使用できるすべてのユーザー
- テトリスゲームを楽しみたいユーザー

### 1.3 動作環境
- モダンWebブラウザ（Chrome, Firefox, Safari, Edge）
- デスクトップおよびモバイルデバイス対応

## 2. 機能要件

### 2.1 ゲームの基本機能
- テトリミノ（テトリスブロック）の自動落下
- プレイヤーによるテトリミノの操作（移動、回転）
- ライン消去機能
- スコア計算
- ゲームオーバー判定
- ゲームの一時停止/再開

### 2.2 テトリミノの種類（7種類）
- I型（水色）: 縦または横に4マス
- O型（黄色）: 2x2の正方形
- T型（紫色）: T字型
- S型（緑色）: S字型
- Z型（赤色）: Z字型
- J型（青色）: L字の鏡像
- L型（オレンジ）: L字型

### 2.3 操作機能
- ← → キー: 左右移動
- ↑ キー: 回転（時計回り）
- ↓ キー: 高速落下（ソフトドロップ）
- スペースキー: 即座に落下（ハードドロップ）
- P キー: 一時停止/再開

### 2.4 ゲーム進行機能
- レベルシステム（落下速度の増加）
- ネクストブロック表示
- ホールド機能（ブロックの保持）

### 2.5 スコアリング
- 1ライン消去: 100点 × レベル
- 2ライン消去: 300点 × レベル
- 3ライン消去: 500点 × レベル
- 4ライン消去（テトリス）: 800点 × レベル
- ソフトドロップ: 1点/マス
- ハードドロップ: 2点/マス

## 3. アーキテクチャ設計

### 3.1 技術スタック
- **フロントエンド**: HTML5, CSS3, JavaScript（Vanilla JS または TypeScript）
- **グラフィックス**: Canvas API
- **ビルドツール**: なし（シンプルな構成の場合）または Vite/Webpack

### 3.2 モジュール構成
```
tetris/
├── index.html          # メインHTMLファイル
├── styles/
│   └── main.css        # スタイルシート
├── src/
│   ├── main.js         # エントリーポイント
│   ├── game.js         # ゲームループとメインロジック
│   ├── board.js        # ゲームボードの管理
│   ├── tetromino.js    # テトリミノクラス
│   ├── renderer.js     # 描画処理
│   ├── input.js        # 入力処理
│   ├── score.js        # スコア管理
│   └── constants.js    # 定数定義
└── docs/
    ├── design.md       # 本設計書
    └── technical.md    # 技術仕様書
```

### 3.3 主要クラス/モジュール

#### Game
- ゲーム全体の状態管理
- ゲームループの制御
- レベル管理

#### Board
- ゲームボード（フィールド）の状態管理
- ブロックの配置判定
- ライン消去処理

#### Tetromino
- テトリミノの形状データ
- 回転処理
- 移動処理

#### Renderer
- Canvas描画処理
- UI更新

#### InputHandler
- キーボード入力の処理
- タッチ入力の処理（モバイル対応）

## 4. データ構造

### 4.1 ゲームボード
```javascript
// 10列 × 20行の2次元配列
board = [
  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
  // ... 20行
]
// 0: 空、1-7: 各テトリミノの色ID
```

### 4.2 テトリミノ形状データ
```javascript
shapes = {
  I: [[1, 1, 1, 1]],
  O: [[1, 1], [1, 1]],
  T: [[0, 1, 0], [1, 1, 1]],
  // ... 他の形状
}
```

### 4.3 ゲーム状態
```javascript
gameState = {
  board: [],              // ゲームボード
  currentPiece: {},       // 現在のテトリミノ
  nextPiece: {},          // 次のテトリミノ
  heldPiece: null,        // ホールドされたテトリミノ
  score: 0,               // スコア
  level: 1,               // レベル
  lines: 0,               // 消したライン数
  isGameOver: false,      // ゲームオーバーフラグ
  isPaused: false         // 一時停止フラグ
}
```

## 5. ゲームロジック

### 5.1 ゲームループ
1. 入力処理
2. ゲーム状態更新
3. 当たり判定
4. ライン消去チェック
5. 描画更新
6. 次のフレームへ

### 5.2 テトリミノの移動・回転ロジック
1. 移動/回転の試行
2. ボード境界チェック
3. 他のブロックとの衝突チェック
4. 有効な場合のみ移動/回転を確定

### 5.3 ライン消去ロジック
1. 各行をチェック
2. すべてのマスが埋まっている行を検出
3. 該当行を削除
4. 上の行を下にシフト
5. スコア加算

### 5.4 レベルアップロジック
- 10ライン消去ごとにレベルアップ
- レベルに応じて落下速度を増加
- 落下間隔 = 1000ms - (level - 1) × 100ms（最小100ms）

## 6. UI/UX設計

### 6.1 画面レイアウト
```
+----------------------------------+
|         テトリスゲーム            |
+----------------------------------+
| ホールド |  ゲームボード  | ネクスト |
|   エリア |  (10×20)      |  エリア  |
|          |               |         |
+----------------------------------+
| スコア: 0000  レベル: 1  ライン: 0 |
+----------------------------------+
|         操作説明・ボタン           |
+----------------------------------+
```

### 6.2 カラースキーム
- 背景: ダークグレー (#1a1a1a)
- ボード: ブラック (#000000)
- グリッド線: グレー (#333333)
- テキスト: ホワイト (#ffffff)
- テトリミノ: 各種定義色

### 6.3 アニメーション
- ライン消去時のフラッシュエフェクト
- ゲームオーバー時のフェードアウト
- スムーズなブロック移動

## 7. 今後の拡張機能（オプション）

### 7.1 追加機能候補
- ハイスコア記録（LocalStorage使用）
- サウンドエフェクト・BGM
- ゴーストピース（落下予測表示）
- ウォールキック（壁蹴り）
- Tスピン判定
- マルチプレイヤー機能

### 7.2 難易度設定
- イージー、ノーマル、ハードモード
- 初期レベル選択

## 8. 開発フェーズ

### フェーズ1: 基本実装
- ゲームボードの描画
- テトリミノの表示と基本操作
- 自動落下機能

### フェーズ2: コア機能
- 回転処理
- 当たり判定
- ライン消去
- スコア計算

### フェーズ3: ゲーム機能
- ネクスト表示
- ホールド機能
- レベルシステム
- ゲームオーバー処理

### フェーズ4: UI/UX改善
- スタイリング
- アニメーション
- レスポンシブ対応

### フェーズ5: 最適化とテスト
- パフォーマンス最適化
- バグフィックス
- クロスブラウザテスト
